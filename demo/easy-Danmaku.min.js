/*!
 * eazyDanmuku v1.0.7
 * (c) 2020 Peng Pan
 * @license MIT
 */
"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var EasyDanmaku=function(){function t(e){_classCallCheck(this,t),this.container=this.checkParams(e),this.wrapperStyle=e.wrapperStyle||null,this.line=e.line||10,this.speed=e.speed||5,this.runtime=e.runtime||10,this.colourful=e.colourful||!1,this.loop=e.loop||!1,this.hover=e.hover||!1,this.coefficient=e.coefficient||1.38,this.originIndex=0,this.originList=null,this.offsetValue=this.container.offsetHeight/this.line,this.vipIndex=0,this.overflowArr=[],this.clearIng=!1,this.cleartimer=null,this.init(),this.handleEvents(e)}return _createClass(t,[{key:"handleEvents",value:function(e){this.onComplete=e.onComplete||null,this.onHover=e.onHover||null}},{key:"init",value:function(){this.runstatus=1,this.aisle=[],this.container.style.overflow="hidden",this.hover&&this.handleMouseHover(),"relative"!==Utils.getStyle(this.container,"position")&&"fixed"!==Utils.getStyle(this.container,"position")&&(this.container.style.position="relative");for(var e=0;e<this.line;e++)this.aisle.push({normalRow:!0,vipRow:!0})}},{key:"checkParams",value:function(e){if(!document.querySelector(e.el))throw"Could not find the "+e.el+" element";if(e.wrapperStyle&&"string"!=typeof e.wrapperStyle)throw"The type accepted by the wrapperStyle parameter is string";if(e.line&&"number"!=typeof e.line)throw"The type accepted by the line parameter is number";if(e.speed&&"number"!=typeof e.speed)throw"The type accepted by the speed parameter is number";if(e.colourful&&"boolean"!=typeof e.colourful)throw"The type accepted by the colourful parameter is boolean";if(e.runtime&&"number"!=typeof e.runtime)throw"The type accepted by the runtime parameter is number";if(e.loop&&"boolean"!=typeof e.loop)throw"The type accepted by the loop parameter is boolean";if(e.coefficient&&"number"!=typeof e.coefficient)throw"The type accepted by the coefficient parameter is number";if(e.hover&&"boolean"!=typeof e.hover)throw"The type accepted by the hover parameter is boolean";if(e.onComplete&&"function"!=typeof e.onComplete)throw"The type accepted by the onComplete parameter is function";if(e.onHover&&"function"!=typeof e.onHover)throw"The type accepted by the onHover parameter is function";return document.querySelector(e.el)}},{key:"send",value:function(n,e,t){var i,r,o,a,l,s=1<arguments.length&&void 0!==e?e:null,h=2<arguments.length&&void 0!==t?t:null;function u(){var e,t=this;r=Math.round(Math.random()*(this.line-1)),this.aisle[r].normalRow?(this.aisle[r].normalRow=!1,this.container.appendChild(i),o+=i.offsetWidth/i.parentNode.offsetWidth*2,i.style.cssText="\n                    text-align:center;\n                    min-width:130px;\n                    will-change: transform;\n                    position:absolute;\n                    right: -"+(i.offsetWidth+130)+"px;\n                    transition: transform "+o+"s linear;\n                    transform: translateX(-"+(i.parentNode.offsetWidth+i.offsetWidth+130)+"px);\n                    top: "+r*this.offsetValue+"px;\n                    line-height:"+this.offsetValue+"px;\n                    color:"+(this.colourful?"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6):void 0)+"\n                ",e=(i.parentNode.offsetWidth+i.offsetWidth)/o/60,a=setInterval(function(){(l+=e)>i.offsetWidth*t.coefficient&&(t.aisle[r].normalRow=!0,clearInterval(a))},16.66),setTimeout(function(){1!=i.getAttribute("relieveDel")&&(h&&h({runtime:o,target:i,width:i.offsetWidth}),i.remove())},1e3*o)):this.aisle.some(function(e){return!0===e.normalRow})?u.call(this):(t.overflowArr.push({content:n,normalClass:s}),t.clearIng||t.clearOverflowDanmakuArray())}0!=this.runstatus?n.length<1||(i=document.createElement("div"),r=0,o=this.speed,a=null,l=0,i.innerHTML=n,i.style.display="inline-block",i.classList.add("default-style"),(s||this.wrapperStyle)&&i.classList.add(s||this.wrapperStyle),u.call(this)):this.overflowArr.push({content:n,normalClass:s})}},{key:"batchSend",value:function(e,t,n){var i=this,r=1<arguments.length&&void 0!==t&&t,o=2<arguments.length&&void 0!==n?n:null,a=this.runtime||1.23*e.length;this.originList=e,this.hasAvatar=r,this.normalClass=o;var l=setInterval(function(){i.originIndex>e.length-1?(clearInterval(l),i.originIndex=0,i.onComplete&&i.onComplete(),i.loop&&i.batchSend(i.originList,r,o)):(r?i.send("<img src="+e[i.originIndex].avatar+">\n                        <p>"+e[i.originIndex].content+"</p>\n                    ",o||i.wrapperStyle):i.send(e[i.originIndex],o||i.wrapperStyle),i.originIndex++)},a/e.length*1e3)}},{key:"centeredSend",value:function(e,t,n,i){var r=2<arguments.length&&void 0!==n?n:3e3,o=3<arguments.length&&void 0!==i?i:null,a=document.createElement("div"),l=0;function s(){var e=this;if(this.aisle[l].vipRow)this.container.appendChild(a),a.style.cssText="\n                    position:absolute;\n                    left:50%;\n                    transform:translateX(-50%);\n                    top: "+l*this.offsetValue+"px;\n                ",this.aisle[l].vipRow=!1,setTimeout(function(){o&&o({duration:r,target:a,width:a.offsetWidth}),a.remove(),e.aisle[l].vipRow=!0},r);else{if(++l>this.line-1)return;s.call(this)}}a.innerHTML=e,(t||this.wrapperStyle)&&a.classList.add(t||this.wrapperStyle),s.call(this)}},{key:"play",value:function(){for(var e=this.container.children,t=0;t<e.length;t++)this.controlDanmakurunStatus(e[t],1);this.runstatus=1,0!==this.overflowArr.length&&this.clearOverflowDanmakuArray()}},{key:"pause",value:function(){for(var e=this.container.children,t=0;t<e.length;t++)this.controlDanmakurunStatus(e[t],0);this.runstatus=0}},{key:"controlDanmakurunStatus",value:function(e,t){var n,i,r=0,o=/-(\S*),/;t===1?(clearTimeout(e.timer),n=Utils.getStyle(e,"transform").match(o)[1],e.style.transition="transform "+this.speed+"s linear",e.style.transform="translateX(-"+(e.parentNode.offsetWidth+parseInt(n)+e.offsetWidth+130)+"px)",e.timer=setTimeout(function(){e.remove()},1e3*this.speed)):t===r&&(clearTimeout(e.timer),i=Utils.getStyle(e,"transform").match(o)[1],e.style.transition="transform 0s linear",e.style.transform="translateX(-"+i+"px)",e.setAttribute("relieveDel",1))}},{key:"handleMouseHover",value:function(){var t=this;Utils.eventDelegation(this.container,"default-style","mouseover",function(e){e.style["z-index"]=1e3,t.controlDanmakurunStatus(e,0),t.onHover&&t.onHover(e)}),Utils.eventDelegation(this.container,"default-style","mouseout",function(e){(e.style.zIndex=1)==t.runstatus&&t.controlDanmakurunStatus(e,1)})}},{key:"clearOverflowDanmakuArray",value:function(){var e=this;clearInterval(this.cleartimer),this.clearIng=!0;var t=0;this.cleartimer=setInterval(function(){0===e.overflowArr.length?20<++t&&(clearInterval(e.cleartimer),e.clearIng=!1):(e.send(e.overflowArr[0].content,e.overflowArr[0].normalClass||e.wrapperStyle),e.overflowArr.shift())},500)}}]),t}(),Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getStyle",value:function(e,t){return window.getComputedStyle(e,null)[t]}},{key:"eventDelegation",value:function(e,n,t,i){e.addEventListener(t,function(e){var t=e.target;t.className.includes(n)&&i(t)})}}]),e}();